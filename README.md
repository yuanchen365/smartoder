# 永豐金 Shioaji 庫存智慧監控機器人

這是一個基於 Python Streamlit 與 Shioaji API 開發的網頁版庫存監控應用程式。
它能協助您自動監控庫存股票，並執行 **移動停損 (Trailing Stop)** 策略，在獲利回吐達到設定百分比時自動賣出，鎖住獲利。

## ✨ 主要功能

1.  **自動化移動停損**：
    *   自動抓取庫存自「指定起始日」以來 (包含盤中即時) 的 **最高價**。
    *   若股價從波段最高點回檔超過設定的 **百分比 (%)**，自動觸發賣出。
2.  **視覺化 K 線圖**：
    *   針對庫存股票自動繪製 **日 K 線圖**。
    *   內建 **MA20 (月線)** 與 **MA60 (季線)** 供技術分析參考。
3.  **彈性監控設定**：
    *   可針對個別股票設定 **「長期投資」** (勾選後排除監控)。
    *   支援 **ROD (跌停價/限價)**、**IOC**、**FOK** 等下單模式 (為了確保成交，ROD 模式會以跌停價送出)。
4.  **即時監控面板**：
    *   側邊欄 (Sidebar) 快速啟動/停止監控。
    *   表格化顯示庫存成本、現價、監控狀態與預估出場價。

## 📂 專案結構

```
smartoder/
├── app.py              # 主程式 (Streamlit 介面與核心邏輯)
├── requirements.txt    # 專案依賴套件列表
├── .env                # (重要) 存放 API 金鑰與憑證設定
├── README.md           # 說明文件
└── .gitignore          # Git 忽略設定
```

## 🚀 快速開始

### 1. 安裝環境與套件

建議使用 Python 3.8 ~ 3.10 環境。

```bash
# 1. 切換到專案目錄
cd path/to/smartoder

# 2. 安裝必要套件
pip install -r requirements.txt
```

### 2. 設定環境變數 (.env)

請在專案根目錄建立一個 `.env` 檔案，填入您的永豐金 API 資訊：

```ini
# .env 檔案範例
SHIOAJI_API_KEY=您的API_Key
SHIOAJI_SECRET_KEY=您的Secret_Key
SHIOAJI_CERT_PERSON_ID=您的身分證字號(含大寫英文)
SHIOAJI_CERT_PASSWORD=您的憑證密碼
SHIOAJI_CERT_PATH=C:/Sinopac/Sinopac.pfx
```

### 3. 啟動應用程式

```bash
streamlit run app.py
```

啟動後，瀏覽器會自動開啟 (預設網址為 `http://localhost:8501`)。

## 📖 使用說明

1.  **登入**：
    *   左側側邊欄會自動帶入 `.env` 的設定，點擊 **「登入並取得庫存」**。
2.  **設定策略**：
    *   **庫存基準日期**：設定此波段的起始日 (程式會去抓這天之後的歷史最高價)。
    *   **下單模式**：預設建議使用 `ROD`。
    *   **移動停損/停利百分比**：設定回檔多少 % 要出場 (預設 15.0%)。
3.  **檢視與篩選庫存**：
    *   畫面中央會列出您的所有庫存。
    *   若某檔股票是長期持有不想賣出，請勾選 **「長期投資 (不監控)」**。
    *   **「預估出場價」** 欄位會顯示目前的防守點位。
4.  **啟動監控**：
    *   確認無誤後，點擊左側側邊欄的 **「🚀 啟動監控」**。
    *   程式會在背景每 3 秒檢查一次股價。
    *   若觸發停損，會自動下單並移除監控清單，並在下方日誌顯示紀錄。
5.  **查看走勢**：
    *   頁面最下方會列出所有庫存的 K 線圖，幫助您判斷趨勢。

## ⚠️ 注意事項

*   **API 憑證**：請確保您的電腦已正確安裝永豐金憑證 (.pfx) 且路徑正確。
*   **電腦休眠**：監控期間請勿讓電腦進入休眠或斷網，否則監控會中斷。
*   **交易風險**：本程式輔助交易，實際下單狀況仍需以券商回報為準，請隨時留意執行狀況。

---
Developed for Sinopac Shioaji API Users.
